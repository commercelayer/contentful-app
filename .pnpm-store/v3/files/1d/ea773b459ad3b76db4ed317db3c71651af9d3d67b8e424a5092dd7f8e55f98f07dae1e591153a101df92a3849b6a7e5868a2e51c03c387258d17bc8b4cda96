"use strict";var __classPrivateFieldSet=this&&this.__classPrivateFieldSet||function(s,t,r,e,a){if(e==="m")throw new TypeError("Private method is not writable");if(e==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?s!==t||!a:!t.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e==="a"?a.call(s,r):a?a.value=r:t.set(s,r),r},__classPrivateFieldGet=this&&this.__classPrivateFieldGet||function(s,t,r,e){if(r==="a"&&!e)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?s!==t||!e:!t.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?e:r==="a"?e.call(s):e?e.value:t.get(s)},__importDefault=this&&this.__importDefault||function(s){return s&&s.__esModule?s:{default:s}},_ResourceAdapter_client,_ResourceAdapter_config;Object.defineProperty(exports,"__esModule",{value:!0}),exports.ApiResource=void 0;const client_1=__importDefault(require("./client")),jsonapi_1=require("./jsonapi"),query_1=require("./query"),config_1=__importDefault(require("./config"));class ListResponse extends Array{constructor(t,r){super(...r||[]);this.meta=t}first(){return this.length?this[0]:void 0}last(){return this.length?this[this.length-1]:void 0}get(t){return this.length&&t>=0?this[t]:void 0}}class ResourceAdapter{constructor(t){_ResourceAdapter_client.set(this,void 0),_ResourceAdapter_config.set(this,{}),__classPrivateFieldSet(this,_ResourceAdapter_client,client_1.default.create(t),"f"),this.config(t)}get interceptors(){return __classPrivateFieldGet(this,_ResourceAdapter_client,"f").interceptors}config(t){!t||__classPrivateFieldGet(this,_ResourceAdapter_client,"f").config(t)}async singleton(t,r,e){const a=(0,query_1.generateQueryStringParams)(r);(e==null?void 0:e.params)&&Object.assign(a,e==null?void 0:e.params);const i=await __classPrivateFieldGet(this,_ResourceAdapter_client,"f").request("get",`${t.type}`,void 0,Object.assign(Object.assign({},e),{params:a}));return(0,jsonapi_1.denormalize)(i)}async retrieve(t,r,e){const a=(0,query_1.generateQueryStringParams)(r);(e==null?void 0:e.params)&&Object.assign(a,e==null?void 0:e.params);const i=await __classPrivateFieldGet(this,_ResourceAdapter_client,"f").request("get",`${t.type}/${t.id}`,void 0,Object.assign(Object.assign({},e),{params:a}));return(0,jsonapi_1.denormalize)(i)}async list(t,r,e){var a,i;const n=(0,query_1.generateQueryStringParams)(r);(e==null?void 0:e.params)&&Object.assign(n,e==null?void 0:e.params);const u=await __classPrivateFieldGet(this,_ResourceAdapter_client,"f").request("get",`${t.type}`,void 0,Object.assign(Object.assign({},e),{params:n})),c=(0,jsonapi_1.denormalize)(u),d={pageCount:Number((a=u.meta)===null||a===void 0?void 0:a.page_count),recordCount:Number((i=u.meta)===null||i===void 0?void 0:i.record_count),currentPage:(r==null?void 0:r.pageNumber)||config_1.default.default.pageNumber,recordsPerPage:(r==null?void 0:r.pageSize)||config_1.default.default.pageSize};return new ListResponse(d,c)}async create(t,r,e){const a=(0,query_1.generateQueryStringParams)(r);(e==null?void 0:e.params)&&Object.assign(a,e==null?void 0:e.params);const i=(0,jsonapi_1.normalize)(t),n=await __classPrivateFieldGet(this,_ResourceAdapter_client,"f").request("post",t.type,i,Object.assign(Object.assign({},e),{params:a}));return(0,jsonapi_1.denormalize)(n)}async update(t,r,e){const a=(0,query_1.generateQueryStringParams)(r);(e==null?void 0:e.params)&&Object.assign(a,e==null?void 0:e.params);const i=(0,jsonapi_1.normalize)(t),n=await __classPrivateFieldGet(this,_ResourceAdapter_client,"f").request("patch",`${t.type}/${t.id}`,i,Object.assign(Object.assign({},e),{params:a}));return(0,jsonapi_1.denormalize)(n)}async delete(t,r){await __classPrivateFieldGet(this,_ResourceAdapter_client,"f").request("delete",`${t.type}/${t.id}`,void 0,r)}}_ResourceAdapter_client=new WeakMap,_ResourceAdapter_config=new WeakMap;class ApiResource{constructor(t){this.resources=t}}exports.ApiResource=ApiResource,exports.default=ResourceAdapter;